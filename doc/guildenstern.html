<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>guildenstern</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">guildenstern</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    <li>
      <a href="theindex.html">Index</a>
    </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="example_toc" href="#example">Example</a></li>
<li><a class="reference" id="see-also_toc" href="#see-also">See also</a></li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#GuildenServer"
    title="GuildenServer {.inheritable.} = ref object">GuildenServer</a></li>
  <li><a class="reference" href="#SocketData"
    title="SocketData = object
  port*: uint16
  socket*: nativesockets.SocketHandle
  ctxid*: CtxId
  customdata*: pointer">SocketData</a></li>
  <li><a class="reference" href="#Ctx"
    title="Ctx {.inheritable, shallow.} = ref object
  gs*: ptr GuildenServer
  socketdata*: ptr SocketData">Ctx</a></li>
  <li><a class="reference" href="#HttpCtx"
    title="HttpCtx = ref object of Ctx">HttpCtx</a></li>
  <li><a class="reference" href="#RequestCallback"
    title="RequestCallback = proc (ctx: Ctx) {.nimcall, raises: [].}">RequestCallback</a></li>
  <li><a class="reference" href="#TimerCallback"
    title="TimerCallback = proc () {.raises: [].}">TimerCallback</a></li>
  <li><a class="reference" href="#ThreadInitializationCallback"
    title="ThreadInitializationCallback = proc () {.gcsafe, raises: [].}">ThreadInitializationCallback</a></li>
  <li><a class="reference" href="#SocketCloseCause"
    title="SocketCloseCause = enum
  CloseCalled,              ## &quot;you&quot; called closeSocket from application code
  ClosedbyClient,           ## Client closed the connection
  ConnectionLost,           ## TCP/IP connection was dropped
  TimedOut,                 ## Client did not send/receive all expected data
  ProtocolViolated,         ## Client was sending garbage
  AlreadyClosed,            ## Another thread has closed the socket
  NetErrored,               ## Some operating system level error happened
  Excepted                   ## A Nim exception happened">SocketCloseCause</a></li>
  <li><a class="reference" href="#CloseCallback"
    title="CloseCallback = proc (ctx: Ctx; cause: SocketCloseCause; msg: string) {.gcsafe,
    nimcall, raises: [].}">CloseCallback</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#10" id="60">Consts</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#MaxHeaderLength"
    title="MaxHeaderLength = 10000">MaxHeaderLength</a></li>
  <li><a class="reference" href="#MaxRequestLength"
    title="MaxRequestLength = 100000">MaxRequestLength</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">registerThreadInitializer
      <li><a class="reference" href="#registerThreadInitializer%2CGuildenServer%2CThreadInitializationCallback"
    title="registerThreadInitializer(gs: GuildenServer;
                          callback: ThreadInitializationCallback)">registerThreadInitializer,<wbr>GuildenServer,<wbr>ThreadInitializationCallback</a></li>

  </ul>
  <ul class="simple nested-toc-section">registerTimerhandler
      <li><a class="reference" href="#registerTimerhandler%2CGuildenServer%2CTimerCallback%2Cint"
    title="registerTimerhandler(gs: GuildenServer; callback: TimerCallback; interval: int)">registerTimerhandler,<wbr>GuildenServer,<wbr>TimerCallback,<wbr>int</a></li>

  </ul>
  <ul class="simple nested-toc-section">getBody
      <li><a class="reference" href="#getBody%2CHttpCtx"
    title="getBody(ctx: HttpCtx): string">getBody,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">getBodylen
      <li><a class="reference" href="#getBodylen%2CHttpCtx"
    title="getBodylen(ctx: HttpCtx): int">getBodylen,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">startsUri
      <li><a class="reference" href="#startsUri%2CHttpCtx%2Cstring"
    title="startsUri(ctx: HttpCtx; uristart: string): bool">startsUri,<wbr>HttpCtx,<wbr>string</a></li>

  </ul>
  <ul class="simple nested-toc-section">isMethod
      <li><a class="reference" href="#isMethod%2CHttpCtx%2Cstring"
    title="isMethod(ctx: HttpCtx; amethod: string): bool">isMethod,<wbr>HttpCtx,<wbr>string</a></li>

  </ul>
  <ul class="simple nested-toc-section">shutdown
      <li><a class="reference" href="#shutdown"
    title="shutdown()">shutdown</a></li>

  </ul>
  <ul class="simple nested-toc-section">getMethod
      <li><a class="reference" href="#getMethod%2CHttpCtx"
    title="getMethod(ctx: HttpCtx): string">getMethod,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">getRequest
      <li><a class="reference" href="#getRequest%2CHttpCtx"
    title="getRequest(ctx: HttpCtx): string">getRequest,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">closeSocket
      <li><a class="reference" href="#closeSocket%2CCtx%2Cstring"
    title="closeSocket(ctx: Ctx; cause = CloseCalled; msg = &quot;&quot;)">closeSocket,<wbr>Ctx,<wbr>string</a></li>

  </ul>
  <ul class="simple nested-toc-section">registerConnectionclosedhandler
      <li><a class="reference" href="#registerConnectionclosedhandler%2CGuildenServer%2CCloseCallback"
    title="registerConnectionclosedhandler(gs: GuildenServer; callback: CloseCallback)">registerConnectionclosedhandler,<wbr>GuildenServer,<wbr>CloseCallback</a></li>

  </ul>
  <ul class="simple nested-toc-section">getUri
      <li><a class="reference" href="#getUri%2CHttpCtx"
    title="getUri(ctx: HttpCtx): string">getUri,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">isBody
      <li><a class="reference" href="#isBody%2CHttpCtx%2Cstring"
    title="isBody(ctx: HttpCtx; body: string): bool">isBody,<wbr>HttpCtx,<wbr>string</a></li>

  </ul>
  <ul class="simple nested-toc-section">serve
      <li><a class="reference" href="#serve%2CGuildenServer"
    title="serve(gs: GuildenServer; multithreaded = true)">serve,<wbr>GuildenServer</a></li>

  </ul>
  <ul class="simple nested-toc-section">isUri
      <li><a class="reference" href="#isUri%2CHttpCtx%2Cstring"
    title="isUri(ctx: HttpCtx; uri: string): bool">isUri,<wbr>HttpCtx,<wbr>string</a></li>

  </ul>
  <ul class="simple nested-toc-section">getHeaders
      <li><a class="reference" href="#getHeaders%2CHttpCtx"
    title="getHeaders(ctx: HttpCtx): string">getHeaders,<wbr>HttpCtx</a></li>

  </ul>
  <ul class="simple nested-toc-section">parseHeaders
      <li><a class="reference" href="#parseHeaders%2CHttpCtx%2CopenArray%5Bstring%5D%2CopenArray%5Bstring%5D"
    title="parseHeaders(ctx: HttpCtx; fields: openArray[string];
             toarray: var openArray[string])">parseHeaders,<wbr>HttpCtx,<wbr>openArray[string],<wbr>openArray[string]</a></li>
  <li><a class="reference" href="#parseHeaders%2CHttpCtx%2CStringTableRef"
    title="parseHeaders(ctx: HttpCtx; headers: StringTableRef)">parseHeaders,<wbr>HttpCtx,<wbr>StringTableRef</a></li>

  </ul>
  <ul class="simple nested-toc-section">getBodystart
      <li><a class="reference" href="#getBodystart%2CHttpCtx"
    title="getBodystart(ctx: HttpCtx): int">getBodystart,<wbr>HttpCtx</a></li>

  </ul>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#18" id="68">Templates</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#reply.t%2CHttpCtx%2CHttpCode%2Cstring%2CopenArray%5Bstring%5D"
    title="reply(ctx: HttpCtx; code: HttpCode; body: string; headers: openArray[string])">reply</a></li>
  <li><a class="reference" href="#reply.t%2CHttpCtx%2CHttpCode%2CopenArray%5Bstring%5D"
    title="reply(ctx: HttpCtx; code: HttpCode; headers: openArray[string])">reply</a></li>
  <li><a class="reference" href="#reply.t%2CHttpCtx%2Cstring"
    title="reply(ctx: HttpCtx; body: string)">reply</a></li>
  <li><a class="reference" href="#reply.t%2CHttpCtx%2CHttpCode%2Cstring"
    title="reply(ctx: HttpCtx; code: HttpCode; body: string)">reply</a></li>
  <li><a class="reference" href="#replyStart.t%2CHttpCtx%2CHttpCode%2Cint%2Cstring%2CopenArray%5Bstring%5D"
    title="replyStart(ctx: HttpCtx; code: HttpCode; contentlength: int; firstpart: string;
           headers: openArray[string]): bool">replyStart</a></li>
  <li><a class="reference" href="#replyStart.t%2CHttpCtx%2CHttpCode%2Cint%2Cstring"
    title="replyStart(ctx: HttpCtx; code: HttpCode; contentlength: int; firstpart: string): bool">replyStart</a></li>
  <li><a class="reference" href="#replyMore.t%2CHttpCtx%2Cstring"
    title="replyMore(ctx: HttpCtx; bodypart: string): bool">replyMore</a></li>
  <li><a class="reference" href="#replyLast.t%2CHttpCtx%2Cstring"
    title="replyLast(ctx: HttpCtx; lastpart: string)">replyLast</a></li>
  <li><a class="reference" href="#replyLast.t%2CHttpCtx"
    title="replyLast(ctx: HttpCtx)">replyLast</a></li>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc">A modular multithreading Linux HTTP server. Easily create and add handlers. Associate handlers with ports. Genuinely multithreading: spawns new thread for every request. Runs in single-threaded mode, too. No need to use async/await.
<h1><a class="toc-backref" id="example" href="#example">Example</a></h1><p>In this example port number is coded to html just for demonstration purposes. In reality, use your reverse proxy to route different types of requests to different ports.</p>
<pre class="listing"><span class="Comment"># nim c -r --gc:arc --d:release --threads:on --d:threadsafe example.nim</span>

<span class="Keyword">import</span> <span class="Identifier">cgi</span><span class="Punctuation">,</span> <span class="Identifier">guildenstern</span><span class="Operator">/</span><span class="Punctuation">[</span><span class="Identifier">ctxheader</span><span class="Punctuation">,</span> <span class="Identifier">ctxfull</span><span class="Punctuation">]</span>

<span class="Keyword">let</span> <span class="Identifier">origin</span> <span class="Operator">=</span> <span class="StringLit">&quot;http://localhost:5050&quot;</span>
<span class="Keyword">let</span> <span class="Identifier">html</span> <span class="Operator">=</span> <span class="LongStringLit">&quot;&quot;&quot;
&lt;!doctype html&gt;&lt;title&gt;GuildenStern Example&lt;/title&gt;&lt;body&gt;
&lt;form action=&quot;http://localhost:5051&quot; method=&quot;post&quot;&gt;
&lt;input name=&quot;say&quot; id=&quot;say&quot; value=&quot;Hi&quot;&gt;&lt;button&gt;Send&quot;&quot;&quot;</span>

<span class="Keyword">proc</span> <span class="Identifier">handleGet</span><span class="Punctuation">(</span><span class="Identifier">ctx</span><span class="Punctuation">:</span> <span class="Identifier">HttpCtx</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">reply</span><span class="Punctuation">(</span><span class="Identifier">Http200</span><span class="Punctuation">,</span> <span class="Identifier">html</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">handlePost</span><span class="Punctuation">(</span><span class="Identifier">ctx</span><span class="Punctuation">:</span> <span class="Identifier">HttpCtx</span><span class="Punctuation">,</span> <span class="Identifier">headers</span><span class="Punctuation">:</span> <span class="Identifier">StringTableRef</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">try</span><span class="Punctuation">:</span> <span class="Identifier">echo</span> <span class="Identifier">readData</span><span class="Punctuation">(</span><span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">getBody</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">getOrDefault</span><span class="Punctuation">(</span><span class="StringLit">&quot;say&quot;</span><span class="Punctuation">)</span>
  <span class="Keyword">except</span><span class="Punctuation">:</span> <span class="Keyword">discard</span>
  <span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">reply</span><span class="Punctuation">(</span><span class="Identifier">Http303</span><span class="Punctuation">,</span> <span class="Punctuation">[</span><span class="StringLit">&quot;location: &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">origin</span><span class="Punctuation">]</span><span class="Punctuation">)</span>

<span class="Keyword">var</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">new</span> <span class="Identifier">GuildenServer</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">initHeaderCtx</span><span class="Punctuation">(</span><span class="Identifier">handleGet</span><span class="Punctuation">,</span> <span class="DecNumber">5050</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">initFullCtx</span><span class="Punctuation">(</span><span class="Identifier">handlePost</span><span class="Punctuation">,</span> <span class="DecNumber">5051</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="StringLit">&quot;GuildenStern HTTP server serving at &quot;</span><span class="Punctuation">,</span> <span class="Identifier">origin</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre>
<h1><a class="toc-backref" id="see-also" href="#see-also">See also</a></h1><p><a class="reference external" href="http://htmlpreview.github.io/?https://github.com/olliNiinivaara/GuildenStern/blob/master/doc/ctxheader.html">ctxheader</a><br /><a class="reference external" href="http://htmlpreview.github.io/?https://github.com/olliNiinivaara/GuildenStern/blob/master/doc/ctxfull.html">ctxfull</a><br /><a class="reference external" href="http://htmlpreview.github.io/?https://github.com/olliNiinivaara/GuildenStern/blob/master/doc/ctxstream.html">ctxstream</a><br /><a class="reference external" href="http://htmlpreview.github.io/?https://github.com/olliNiinivaara/GuildenStern/blob/master/doc/ctxws.html">ctxws</a><br /></p></p>
  <div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="GuildenServer"></a>
<dt><pre><a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inheritable</span></span><span class="Other">.}</span></span> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
  </pre></dt>
<dd>

<p>This is available in request context as <tt class="docutils literal"><span class="pre">gs</span></tt> property.<br />You can inherit this and add custom properties as needed.<br /></p>

</dd>
<a id="SocketData"></a>
<dt><pre><a href="guildenstern.html#SocketData"><span class="Identifier">SocketData</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">port</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">uint16</span>
  <span class="Identifier">socket</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">nativesockets</span><span class="Other">.</span><span class="Identifier">SocketHandle</span>
  <span class="Identifier">ctxid</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">CtxId</span>
  <span class="Identifier">customdata</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">pointer</span>
</pre></dt>
<dd>

<p>Data associated with a request context.<br />This is available in request context as <tt class="docutils literal"><span class="pre">socketdata</span></tt> property (probably not needed in application development, though).<br /></p>

</dd>
<a id="Ctx"></a>
<dt><pre><a href="guildenstern.html#Ctx"><span class="Identifier">Ctx</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inheritable</span><span class="Other">,</span> <span class="Identifier">shallow</span></span><span class="Other">.}</span></span> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
  <span class="Identifier">gs</span><span class="Operator">*</span><span class="Other">:</span> <span class="Keyword">ptr</span> <a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a>
  <span class="Identifier">socketdata</span><span class="Operator">*</span><span class="Other">:</span> <span class="Keyword">ptr</span> <a href="guildenstern.html#SocketData"><span class="Identifier">SocketData</span></a>
</pre></dt>
<dd>

<p>Common abstract base class for all request contexts.<br />A request context is received as a parameter in request callbacks. <br /></p>

</dd>
<a id="HttpCtx"></a>
<dt><pre><a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <a href="guildenstern.html#Ctx"><span class="Identifier">Ctx</span></a>
  </pre></dt>
<dd>

<p>Common abstract base class for all HTTP handling request contexts.<br /></p>

</dd>
<a id="RequestCallback"></a>
<dt><pre><a href="guildenstern.html#RequestCallback"><span class="Identifier">RequestCallback</span></a> <span class="Other">=</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#Ctx"><span class="Identifier">Ctx</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">nimcall</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Type for procs that are called when a socket request can be processed. When multithreading, serialize mutations to global vars with locks (use threadvars instead unless memory usage is a problem).

</dd>
<a id="TimerCallback"></a>
<dt><pre><a href="guildenstern.html#TimerCallback"><span class="Identifier">TimerCallback</span></a> <span class="Other">=</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>



</dd>
<a id="ThreadInitializationCallback"></a>
<dt><pre><a href="guildenstern.html#ThreadInitializationCallback"><span class="Identifier">ThreadInitializationCallback</span></a> <span class="Other">=</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">gcsafe</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>



</dd>
<a id="SocketCloseCause"></a>
<dt><pre><a href="guildenstern.html#SocketCloseCause"><span class="Identifier">SocketCloseCause</span></a> <span class="Other">=</span> <span class="Keyword">enum</span>
  <span class="Identifier">CloseCalled</span><span class="Other">,</span>              <span class="Comment">## &quot;you&quot; called closeSocket from application code</span>
  <span class="Identifier">ClosedbyClient</span><span class="Other">,</span>           <span class="Comment">## Client closed the connection</span>
  <span class="Identifier">ConnectionLost</span><span class="Other">,</span>           <span class="Comment">## TCP/IP connection was dropped</span>
  <span class="Identifier">TimedOut</span><span class="Other">,</span>                 <span class="Comment">## Client did not send/receive all expected data</span>
  <span class="Identifier">ProtocolViolated</span><span class="Other">,</span>         <span class="Comment">## Client was sending garbage</span>
  <span class="Identifier">AlreadyClosed</span><span class="Other">,</span>            <span class="Comment">## Another thread has closed the socket</span>
  <span class="Identifier">NetErrored</span><span class="Other">,</span>               <span class="Comment">## Some operating system level error happened</span>
  <span class="Identifier">Excepted</span>                   <span class="Comment">## A Nim exception happened</span></pre></dt>
<dd>

Paremeter in CloseCallback.

</dd>
<a id="CloseCallback"></a>
<dt><pre><a href="guildenstern.html#CloseCallback"><span class="Identifier">CloseCallback</span></a> <span class="Other">=</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#Ctx"><span class="Identifier">Ctx</span></a><span class="Other">;</span> <span class="Identifier">cause</span><span class="Other">:</span> <a href="guildenstern.html#SocketCloseCause"><span class="Identifier">SocketCloseCause</span></a><span class="Other">;</span> <span class="Identifier">msg</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">gcsafe</span><span class="Other">,</span>
    <span class="Identifier">nimcall</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Called whenever a socket is closed.

</dd>

</dl></div>
<div class="section" id="10">
<h1><a class="toc-backref" href="#10">Consts</a></h1>
<dl class="item">
<a id="MaxHeaderLength"></a>
<dt><pre><a href="guildenstern.html#MaxHeaderLength"><span class="Identifier">MaxHeaderLength</span></a> <span class="Other">=</span> <span class="DecNumber">10000</span></pre></dt>
<dd>

Maximum acceptable character length for HTTP header.

</dd>
<a id="MaxRequestLength"></a>
<dt><pre><a href="guildenstern.html#MaxRequestLength"><span class="Identifier">MaxRequestLength</span></a> <span class="Other">=</span> <span class="DecNumber">100000</span></pre></dt>
<dd>

Maximum acceptable length (header length + content length) for a HTTP request (Note: in streaming handlers, this denotes chunk size).

</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="serve,GuildenServer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#serve%2CGuildenServer"><span class="Identifier">serve</span></a><span class="Other">(</span><span class="Identifier">gs</span><span class="Other">:</span> <a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a><span class="Other">;</span> <span class="Identifier">multithreaded</span> <span class="Other">=</span> <span class="Identifier">true</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">gcsafe</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Starts server event dispatcher loop which runs until shutdown() is called or SIGINT received. If you want the server to run in a single thread, set multithreaded to false. Note: debug info is echoed to console if compiled with switch -d:fulldebug.</p>
<p><strong>Example:</strong></p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">guildenstern</span><span class="Operator">/</span><span class="Identifier">ctxheader</span>
<span class="Keyword">proc</span> <span class="Identifier">onRequest</span><span class="Punctuation">(</span><span class="Identifier">ctx</span><span class="Punctuation">:</span> <span class="Identifier">HttpCtx</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">reply</span><span class="Punctuation">(</span><span class="Identifier">Http200</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">new</span> <span class="Identifier">GuildenServer</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">initHeaderCtx</span><span class="Punctuation">(</span><span class="Identifier">onRequest</span><span class="Punctuation">,</span> <span class="DecNumber">5050</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="Identifier">false</span><span class="Punctuation">)</span></pre>

</dd>
<a id="registerThreadInitializer,GuildenServer,ThreadInitializationCallback"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#registerThreadInitializer%2CGuildenServer%2CThreadInitializationCallback"><span class="Identifier">registerThreadInitializer</span></a><span class="Other">(</span><span class="Identifier">gs</span><span class="Other">:</span> <a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a><span class="Other">;</span>
                               <span class="Identifier">callback</span><span class="Other">:</span> <a href="guildenstern.html#ThreadInitializationCallback"><span class="Identifier">ThreadInitializationCallback</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Registers a procedure in which you can initialize threadvars. This is called exactly once for each thread, when it is first created.</p>
<p><strong>Example:</strong></p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">guildenstern</span><span class="Punctuation">,</span> <span class="Identifier">os</span><span class="Punctuation">,</span> <span class="Identifier">random</span>

<span class="Keyword">var</span> <span class="Identifier">threadcount</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
<span class="Keyword">var</span> <span class="Identifier">rounds</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
<span class="Keyword">var</span> <span class="Identifier">x</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">threadvar</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">int</span>

<span class="Keyword">proc</span> <span class="Identifier">initializeThreadvars</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">x</span> <span class="Operator">=</span> <span class="Identifier">threadcount</span><span class="Operator">.</span><span class="Identifier">atomicInc</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;new thread initialized: &quot;</span><span class="Punctuation">,</span> <span class="Identifier">x</span>

<span class="Keyword">proc</span> <span class="Identifier">tiktok</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;tik &quot;</span><span class="Punctuation">,</span> <span class="Identifier">x</span>
  <span class="Identifier">sleep</span><span class="Punctuation">(</span><span class="DecNumber">500</span> <span class="Operator">+</span> <span class="Identifier">rand</span><span class="Punctuation">(</span><span class="DecNumber">2000</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;tok &quot;</span><span class="Punctuation">,</span> <span class="Identifier">x</span>
  <span class="Keyword">if</span> <span class="Identifier">rounds</span><span class="Operator">.</span><span class="Identifier">atomicInc</span> <span class="Operator">&gt;</span> <span class="DecNumber">50</span><span class="Punctuation">:</span> <span class="Identifier">shutdown</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Identifier">randomize</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">new</span> <span class="Identifier">GuildenServer</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">registerThreadInitializer</span><span class="Punctuation">(</span><span class="Identifier">initializeThreadvars</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">registerTimerhandler</span><span class="Punctuation">(</span><span class="Identifier">tiktok</span><span class="Punctuation">,</span> <span class="DecNumber">100</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="StringLit">&quot;----&quot;</span>
<span class="Identifier">echo</span> <span class="StringLit">&quot;waiting for processes to finish...&quot;</span>
<span class="Identifier">sleep</span><span class="Punctuation">(</span><span class="DecNumber">2510</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="StringLit">&quot;graceful shutdown handling here!&quot;</span></pre>

</dd>
<a id="registerTimerhandler,GuildenServer,TimerCallback,int"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#registerTimerhandler%2CGuildenServer%2CTimerCallback%2Cint"><span class="Identifier">registerTimerhandler</span></a><span class="Other">(</span><span class="Identifier">gs</span><span class="Other">:</span> <a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a><span class="Other">;</span> <span class="Identifier">callback</span><span class="Other">:</span> <a href="guildenstern.html#TimerCallback"><span class="Identifier">TimerCallback</span></a><span class="Other">;</span>
                          <span class="Identifier">interval</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Registers a new timer that fires the TimerCallback every <tt class="docutils literal"><span class="pre">interval</span></tt> milliseconds.

</dd>
<a id="registerConnectionclosedhandler,GuildenServer,CloseCallback"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#registerConnectionclosedhandler%2CGuildenServer%2CCloseCallback"><span class="Identifier">registerConnectionclosedhandler</span></a><span class="Other">(</span><span class="Identifier">gs</span><span class="Other">:</span> <a href="guildenstern.html#GuildenServer"><span class="Identifier">GuildenServer</span></a><span class="Other">;</span> <span class="Identifier">callback</span><span class="Other">:</span> <a href="guildenstern.html#CloseCallback"><span class="Identifier">CloseCallback</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Registers procedure that is called whenever socket connection is closed.

</dd>
<a id="closeSocket,Ctx,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#closeSocket%2CCtx%2Cstring"><span class="Identifier">closeSocket</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#Ctx"><span class="Identifier">Ctx</span></a><span class="Other">;</span> <span class="Identifier">cause</span> <span class="Other">=</span> <span class="Identifier">CloseCalled</span><span class="Other">;</span> <span class="Identifier">msg</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Closes the socket.<p>Important: when you call this from application code, let cause be <tt class="docutils literal"><span class="pre">CloseCalled</span></tt>.<br /><tt class="docutils literal"><span class="pre">msg</span></tt> can be any further info that will be delivered to registered CloseCallback.<br /></p>

</dd>
<a id="shutdown"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#shutdown"><span class="Identifier">shutdown</span></a><span class="Other">(</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Cancels pending network I/O and breaks event dispatcher loops of all servers. Sending SIGINT / pressing Ctrl-C will automatically call shutdown().<p>See <tt class="docutils literal"><span class="pre">registerThreadInitializer</span></tt> for example.<br /></p>

</dd>
<a id="getUri,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getUri%2CHttpCtx"><span class="Identifier">getUri</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Request URI of a HttpCtx.

</dd>
<a id="isUri,HttpCtx,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#isUri%2CHttpCtx%2Cstring"><span class="Identifier">isUri</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">uri</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

true if request URI is uri.

</dd>
<a id="startsUri,HttpCtx,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#startsUri%2CHttpCtx%2Cstring"><span class="Identifier">startsUri</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">uristart</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

true if request URI starts with uristart.

</dd>
<a id="getMethod,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getMethod%2CHttpCtx"><span class="Identifier">getMethod</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Request method of a HttpCtx.

</dd>
<a id="isMethod,HttpCtx,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#isMethod%2CHttpCtx%2Cstring"><span class="Identifier">isMethod</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">amethod</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

true if request method is amethod.

</dd>
<a id="getHeaders,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getHeaders%2CHttpCtx"><span class="Identifier">getHeaders</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the header part of request as string.

</dd>
<a id="getBodystart,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getBodystart%2CHttpCtx"><span class="Identifier">getBodystart</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the start position of body in <tt class="docutils literal"><span class="pre">request</span></tt>. If there's no body, returns -1.

</dd>
<a id="getBodylen,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getBodylen%2CHttpCtx"><span class="Identifier">getBodylen</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the length of request body.

</dd>
<a id="getBody,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getBody%2CHttpCtx"><span class="Identifier">getBody</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the body part of request as string.

</dd>
<a id="isBody,HttpCtx,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#isBody%2CHttpCtx%2Cstring"><span class="Identifier">isBody</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

true if request body is body.

</dd>
<a id="getRequest,HttpCtx"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getRequest%2CHttpCtx"><span class="Identifier">getRequest</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the whole request as string.

</dd>
<a id="parseHeaders,HttpCtx,openArray[string],openArray[string]"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#parseHeaders%2CHttpCtx%2CopenArray%5Bstring%5D%2CopenArray%5Bstring%5D"><span class="Identifier">parseHeaders</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">fields</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">;</span>
                  <span class="Identifier">toarray</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Parses header <tt class="docutils literal"><span class="pre">fields</span></tt> values into <tt class="docutils literal"><span class="pre">toarray</span></tt>.</p>
<p><strong>Example:</strong></p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">guildenstern</span><span class="Operator">/</span><span class="Identifier">ctxheader</span>
<span class="Keyword">import</span> <span class="Identifier">httpclient</span>

<span class="Keyword">const</span> <span class="Identifier">headerfields</span> <span class="Operator">=</span> <span class="Punctuation">[</span><span class="StringLit">&quot;afield&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;anotherfield&quot;</span><span class="Punctuation">]</span>
<span class="Keyword">var</span> <span class="Identifier">headers</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">threadvar</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">array</span><span class="Punctuation">[</span><span class="DecNumber">2</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span>
<span class="Keyword">var</span> <span class="Identifier">client</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">threadvar</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HttpClient</span>

<span class="Keyword">proc</span> <span class="Identifier">initializeThreadvars</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">try</span><span class="Punctuation">:</span>
    <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newHttpClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">headers</span> <span class="Operator">=</span> <span class="Identifier">newHttpHeaders</span><span class="Punctuation">(</span>
      <span class="Punctuation">{</span> <span class="StringLit">&quot;afield&quot;</span><span class="Punctuation">:</span> <span class="StringLit">&quot;afieldvalue&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;bfield&quot;</span><span class="Punctuation">:</span> <span class="StringLit">&quot;bfieldvalue&quot;</span> <span class="Punctuation">}</span><span class="Punctuation">)</span>
  <span class="Keyword">except</span><span class="Punctuation">:</span> <span class="Identifier">echo</span> <span class="Identifier">getCurrentExceptionMsg</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">sendRequest</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">try</span><span class="Punctuation">:</span> <span class="Keyword">discard</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;http://localhost:5050&quot;</span><span class="Punctuation">)</span>
  <span class="Keyword">except</span><span class="Punctuation">:</span> <span class="Identifier">echo</span> <span class="Identifier">getCurrentExceptionMsg</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">onRequest</span><span class="Punctuation">(</span><span class="Identifier">ctx</span><span class="Punctuation">:</span> <span class="Identifier">HttpCtx</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">parseHeaders</span><span class="Punctuation">(</span><span class="Identifier">headerfields</span><span class="Punctuation">,</span> <span class="Identifier">headers</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="Identifier">headers</span>
  <span class="Identifier">ctx</span><span class="Operator">.</span><span class="Identifier">reply</span><span class="Punctuation">(</span><span class="Identifier">Http204</span><span class="Punctuation">)</span>

<span class="Identifier">doAssert</span><span class="Punctuation">(</span><span class="Identifier">compileOption</span><span class="Punctuation">(</span><span class="StringLit">&quot;threads&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="LongStringLit">&quot;&quot;&quot;this example must be compiled with threads;
  &quot;nim c -r --gc:arc --threads:on --d:threadsafe example.nim&quot;&quot;&quot;&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">new</span> <span class="Identifier">GuildenServer</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">registerThreadInitializer</span><span class="Punctuation">(</span><span class="Identifier">initializeThreadvars</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">initHeaderCtx</span><span class="Punctuation">(</span><span class="Identifier">onRequest</span><span class="Punctuation">,</span> <span class="DecNumber">5050</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">registerTimerhandler</span><span class="Punctuation">(</span><span class="Identifier">sendRequest</span><span class="Punctuation">,</span> <span class="DecNumber">1000</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre>

</dd>
<a id="parseHeaders,HttpCtx,StringTableRef"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#parseHeaders%2CHttpCtx%2CStringTableRef"><span class="Identifier">parseHeaders</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">headers</span><span class="Other">:</span> <span class="Identifier">StringTableRef</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Parses all headers into given strtabs.StringTable.

</dd>

</dl></div>
<div class="section" id="18">
<h1><a class="toc-backref" href="#18">Templates</a></h1>
<dl class="item">
<a id="reply.t,HttpCtx,HttpCode,string,openArray[string]"></a>
<dt><pre><span class="Keyword">template</span> <a href="#reply.t%2CHttpCtx%2CHttpCode%2Cstring%2CopenArray%5Bstring%5D"><span class="Identifier">reply</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">code</span><span class="Other">:</span> <span class="Identifier">HttpCode</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span>
               <span class="Identifier">headers</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">)</span></pre></dt>
<dd>

Sends a reply to the socket in context. Aborts silently if socket is closed (there's not much to do). Note that body has to be addressable for posix, use lets instead of consts. Syntactic sugar varations of this template below. If you need even more control over replying, see procs in httpresponse module.

</dd>
<a id="reply.t,HttpCtx,HttpCode,openArray[string]"></a>
<dt><pre><span class="Keyword">template</span> <a href="#reply.t%2CHttpCtx%2CHttpCode%2CopenArray%5Bstring%5D"><span class="Identifier">reply</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">code</span><span class="Other">:</span> <span class="Identifier">HttpCode</span><span class="Other">;</span> <span class="Identifier">headers</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">)</span></pre></dt>
<dd>



</dd>
<a id="reply.t,HttpCtx,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#reply.t%2CHttpCtx%2Cstring"><span class="Identifier">reply</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span></pre></dt>
<dd>

Http200 Ok

</dd>
<a id="reply.t,HttpCtx,HttpCode,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#reply.t%2CHttpCtx%2CHttpCode%2Cstring"><span class="Identifier">reply</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">code</span><span class="Other">:</span> <span class="Identifier">HttpCode</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span></pre></dt>
<dd>



</dd>
<a id="replyStart.t,HttpCtx,HttpCode,int,string,openArray[string]"></a>
<dt><pre><span class="Keyword">template</span> <a href="#replyStart.t%2CHttpCtx%2CHttpCode%2Cint%2Cstring%2CopenArray%5Bstring%5D"><span class="Identifier">replyStart</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">code</span><span class="Other">:</span> <span class="Identifier">HttpCode</span><span class="Other">;</span> <span class="Identifier">contentlength</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span>
                    <span class="Identifier">firstpart</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">headers</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span></pre></dt>
<dd>

Indicates that reply will be given in multiple chunks. This first part submits the HTTP status code, content-length, first part of body and headers. Zero or more replyMores can follow. Last chunk should be sent with replyLast (otherwise 200 ms wait for more data occurs). Returns <tt class="docutils literal"><span class="pre">false</span></tt> if socket was closed.

</dd>
<a id="replyStart.t,HttpCtx,HttpCode,int,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#replyStart.t%2CHttpCtx%2CHttpCode%2Cint%2Cstring"><span class="Identifier">replyStart</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">code</span><span class="Other">:</span> <span class="Identifier">HttpCode</span><span class="Other">;</span> <span class="Identifier">contentlength</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span>
                    <span class="Identifier">firstpart</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span></pre></dt>
<dd>



</dd>
<a id="replyMore.t,HttpCtx,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#replyMore.t%2CHttpCtx%2Cstring"><span class="Identifier">replyMore</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">bodypart</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span></pre></dt>
<dd>



</dd>
<a id="replyLast.t,HttpCtx,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#replyLast.t%2CHttpCtx%2Cstring"><span class="Identifier">replyLast</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">;</span> <span class="Identifier">lastpart</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span></pre></dt>
<dd>

Ends a reply started with replyStart.

</dd>
<a id="replyLast.t,HttpCtx"></a>
<dt><pre><span class="Keyword">template</span> <a href="#replyLast.t%2CHttpCtx"><span class="Identifier">replyLast</span></a><span class="Other">(</span><span class="Identifier">ctx</span><span class="Other">:</span> <a href="guildenstern.html#HttpCtx"><span class="Identifier">HttpCtx</span></a><span class="Other">)</span></pre></dt>
<dd>



</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2020-12-16 08:43:50 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
